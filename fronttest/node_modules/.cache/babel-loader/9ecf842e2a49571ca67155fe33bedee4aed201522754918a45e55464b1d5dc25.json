{"ast":null,"code":"import { generateUniqueNumber } from 'fast-unique-numbers';\nimport { renderUnknownPortIdError } from './error-renderers';\nimport { isSupportingTransferables } from './is-supporting-transferables';\nconst DESTROY_WORKER_FUNCTIONS = new Map();\nexport const extendWorkerImplementation = (createWorker, partialWorkerImplementation, isSupportedFunction) => ({\n  ...partialWorkerImplementation,\n  connect: ({\n    port\n  }) => {\n    port.start();\n    const destroyWorker = createWorker(port, partialWorkerImplementation);\n    const portId = generateUniqueNumber(DESTROY_WORKER_FUNCTIONS);\n    DESTROY_WORKER_FUNCTIONS.set(portId, () => {\n      destroyWorker();\n      port.close();\n      DESTROY_WORKER_FUNCTIONS.delete(portId);\n    });\n    return {\n      result: portId\n    };\n  },\n  disconnect: ({\n    portId\n  }) => {\n    const destroyWorker = DESTROY_WORKER_FUNCTIONS.get(portId);\n    if (destroyWorker === undefined) {\n      throw renderUnknownPortIdError({\n        portId: portId.toString()\n      });\n    }\n    destroyWorker();\n    return {\n      result: null\n    };\n  },\n  isSupported: async () => {\n    const isSelfSupported = await isSupportingTransferables();\n    if (isSelfSupported) {\n      const result = isSupportedFunction();\n      const synchronousResult = result instanceof Promise ? await result : result;\n      return {\n        result: synchronousResult\n      };\n    }\n    return {\n      result: false\n    };\n  }\n});","map":{"version":3,"names":["generateUniqueNumber","renderUnknownPortIdError","isSupportingTransferables","DESTROY_WORKER_FUNCTIONS","Map","extendWorkerImplementation","createWorker","partialWorkerImplementation","isSupportedFunction","connect","port","start","destroyWorker","portId","set","close","delete","result","disconnect","get","undefined","toString","isSupported","isSelfSupported","synchronousResult","Promise"],"sources":["/Users/asyuyukiume/AI学習/議事録　テスト/fronttest/node_modules/recorder-audio-worklet/node_modules/worker-factory/src/helpers/extend-worker-implementation.ts"],"sourcesContent":["import { generateUniqueNumber } from 'fast-unique-numbers';\nimport { IDefaultWorkerDefinition, IReceiver, IWorkerDefinition } from '../interfaces';\nimport { TDestroyWorkerFunction, TWorkerImplementation } from '../types';\nimport { renderUnknownPortIdError } from './error-renderers';\nimport { isSupportingTransferables } from './is-supporting-transferables';\n\nconst DESTROY_WORKER_FUNCTIONS: Map<number, TDestroyWorkerFunction> = new Map();\n\nexport const extendWorkerImplementation = <T extends IWorkerDefinition>(\n    createWorker: (receiver: IReceiver, workerImplementation: TWorkerImplementation<T>) => TDestroyWorkerFunction,\n    partialWorkerImplementation: TWorkerImplementation<T>,\n    isSupportedFunction: () => boolean | Promise<boolean>\n): TWorkerImplementation<T> & TWorkerImplementation<IDefaultWorkerDefinition> => ({\n    ...partialWorkerImplementation,\n    connect: ({ port }) => {\n        port.start();\n\n        const destroyWorker = createWorker(port, partialWorkerImplementation);\n        const portId = generateUniqueNumber(DESTROY_WORKER_FUNCTIONS);\n\n        DESTROY_WORKER_FUNCTIONS.set(portId, () => {\n            destroyWorker();\n            port.close();\n            DESTROY_WORKER_FUNCTIONS.delete(portId);\n        });\n\n        return { result: portId };\n    },\n    disconnect: ({ portId }) => {\n        const destroyWorker = DESTROY_WORKER_FUNCTIONS.get(portId);\n\n        if (destroyWorker === undefined) {\n            throw renderUnknownPortIdError({ portId: portId.toString() });\n        }\n\n        destroyWorker();\n\n        return { result: null };\n    },\n    isSupported: async () => {\n        const isSelfSupported = await isSupportingTransferables();\n\n        if (isSelfSupported) {\n            const result = isSupportedFunction();\n            const synchronousResult = result instanceof Promise ? await result : result;\n\n            return { result: synchronousResult };\n        }\n\n        return { result: false };\n    }\n});\n"],"mappings":"AAAA,SAASA,oBAAoB,QAAQ,qBAAqB;AAG1D,SAASC,wBAAwB,QAAQ,mBAAmB;AAC5D,SAASC,yBAAyB,QAAQ,+BAA+B;AAEzE,MAAMC,wBAAwB,GAAwC,IAAIC,GAAG,EAAE;AAE/E,OAAO,MAAMC,0BAA0B,GAAGA,CACtCC,YAA6G,EAC7GC,2BAAqD,EACrDC,mBAAqD,MACyB;EAC9E,GAAGD,2BAA2B;EAC9BE,OAAO,EAAEA,CAAC;IAAEC;EAAI,CAAE,KAAI;IAClBA,IAAI,CAACC,KAAK,EAAE;IAEZ,MAAMC,aAAa,GAAGN,YAAY,CAACI,IAAI,EAAEH,2BAA2B,CAAC;IACrE,MAAMM,MAAM,GAAGb,oBAAoB,CAACG,wBAAwB,CAAC;IAE7DA,wBAAwB,CAACW,GAAG,CAACD,MAAM,EAAE,MAAK;MACtCD,aAAa,EAAE;MACfF,IAAI,CAACK,KAAK,EAAE;MACZZ,wBAAwB,CAACa,MAAM,CAACH,MAAM,CAAC;IAC3C,CAAC,CAAC;IAEF,OAAO;MAAEI,MAAM,EAAEJ;IAAM,CAAE;EAC7B,CAAC;EACDK,UAAU,EAAEA,CAAC;IAAEL;EAAM,CAAE,KAAI;IACvB,MAAMD,aAAa,GAAGT,wBAAwB,CAACgB,GAAG,CAACN,MAAM,CAAC;IAE1D,IAAID,aAAa,KAAKQ,SAAS,EAAE;MAC7B,MAAMnB,wBAAwB,CAAC;QAAEY,MAAM,EAAEA,MAAM,CAACQ,QAAQ;MAAE,CAAE,CAAC;;IAGjET,aAAa,EAAE;IAEf,OAAO;MAAEK,MAAM,EAAE;IAAI,CAAE;EAC3B,CAAC;EACDK,WAAW,EAAE,MAAAA,CAAA,KAAW;IACpB,MAAMC,eAAe,GAAG,MAAMrB,yBAAyB,EAAE;IAEzD,IAAIqB,eAAe,EAAE;MACjB,MAAMN,MAAM,GAAGT,mBAAmB,EAAE;MACpC,MAAMgB,iBAAiB,GAAGP,MAAM,YAAYQ,OAAO,GAAG,MAAMR,MAAM,GAAGA,MAAM;MAE3E,OAAO;QAAEA,MAAM,EAAEO;MAAiB,CAAE;;IAGxC,OAAO;MAAEP,MAAM,EAAE;IAAK,CAAE;EAC5B;CACH,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}