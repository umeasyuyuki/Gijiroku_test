{"ast":null,"code":"import { createBroker } from 'broker-factory';\nimport { addUniqueNumber } from 'fast-unique-numbers';\n/*\n * @todo Explicitly referencing the barrel file seems to be necessary when enabling the\n * isolatedModules compiler option.\n */\nexport * from './interfaces/index';\nexport * from './types/index';\nconst encoderIds = new Set();\nexport const wrap = createBroker({\n  deregister: ({\n    call\n  }) => {\n    return port => {\n      return call('deregister', {\n        port\n      }, [port]);\n    };\n  },\n  encode: ({\n    call\n  }) => {\n    return async (encoderId, timeslice) => {\n      const arrayBuffers = await call('encode', {\n        encoderId,\n        timeslice\n      });\n      encoderIds.delete(encoderId);\n      return arrayBuffers;\n    };\n  },\n  instantiate: ({\n    call\n  }) => {\n    return async (mimeType, sampleRate) => {\n      const encoderId = addUniqueNumber(encoderIds);\n      const port = await call('instantiate', {\n        encoderId,\n        mimeType,\n        sampleRate\n      });\n      return {\n        encoderId,\n        port\n      };\n    };\n  },\n  register: ({\n    call\n  }) => {\n    return port => {\n      return call('register', {\n        port\n      }, [port]);\n    };\n  }\n});\nexport const load = url => {\n  const worker = new Worker(url);\n  return wrap(worker);\n};","map":{"version":3,"names":["createBroker","addUniqueNumber","encoderIds","Set","wrap","deregister","call","port","encode","encoderId","timeslice","arrayBuffers","delete","instantiate","mimeType","sampleRate","register","load","url","worker","Worker"],"sources":["/Users/asyuyukiume/AI学習/議事録　テスト/fronttest/node_modules/media-encoder-host-broker/src/module.ts"],"sourcesContent":["import { createBroker } from 'broker-factory';\nimport { addUniqueNumber } from 'fast-unique-numbers';\nimport { TMediaEncoderHostWorkerDefinition } from 'media-encoder-host-worker';\nimport { IMediaEncoderHostBrokerDefinition } from './interfaces';\nimport { TMediaEncoderHostBrokerLoader, TMediaEncoderHostBrokerWrapper } from './types';\n\n/*\n * @todo Explicitly referencing the barrel file seems to be necessary when enabling the\n * isolatedModules compiler option.\n */\nexport * from './interfaces/index';\nexport * from './types/index';\n\nconst encoderIds: Set<number> = new Set();\n\nexport const wrap: TMediaEncoderHostBrokerWrapper = createBroker<IMediaEncoderHostBrokerDefinition, TMediaEncoderHostWorkerDefinition>({\n    deregister: ({ call }) => {\n        return (port) => {\n            return call('deregister', { port }, [port]);\n        };\n    },\n    encode: ({ call }) => {\n        return async (encoderId, timeslice) => {\n            const arrayBuffers = await call('encode', { encoderId, timeslice });\n\n            encoderIds.delete(encoderId);\n\n            return arrayBuffers;\n        };\n    },\n    instantiate: ({ call }) => {\n        return async (mimeType, sampleRate) => {\n            const encoderId = addUniqueNumber(encoderIds);\n            const port = await call('instantiate', { encoderId, mimeType, sampleRate });\n\n            return { encoderId, port };\n        };\n    },\n    register: ({ call }) => {\n        return (port) => {\n            return call('register', { port }, [port]);\n        };\n    }\n});\n\nexport const load: TMediaEncoderHostBrokerLoader = (url: string) => {\n    const worker = new Worker(url);\n\n    return wrap(worker);\n};\n"],"mappings":"AAAA,SAASA,YAAY,QAAQ,gBAAgB;AAC7C,SAASC,eAAe,QAAQ,qBAAqB;AAKrD;;;;AAIA,cAAc,oBAAoB;AAClC,cAAc,eAAe;AAE7B,MAAMC,UAAU,GAAgB,IAAIC,GAAG,EAAE;AAEzC,OAAO,MAAMC,IAAI,GAAmCJ,YAAY,CAAuE;EACnIK,UAAU,EAAEA,CAAC;IAAEC;EAAI,CAAE,KAAI;IACrB,OAAQC,IAAI,IAAI;MACZ,OAAOD,IAAI,CAAC,YAAY,EAAE;QAAEC;MAAI,CAAE,EAAE,CAACA,IAAI,CAAC,CAAC;IAC/C,CAAC;EACL,CAAC;EACDC,MAAM,EAAEA,CAAC;IAAEF;EAAI,CAAE,KAAI;IACjB,OAAO,OAAOG,SAAS,EAAEC,SAAS,KAAI;MAClC,MAAMC,YAAY,GAAG,MAAML,IAAI,CAAC,QAAQ,EAAE;QAAEG,SAAS;QAAEC;MAAS,CAAE,CAAC;MAEnER,UAAU,CAACU,MAAM,CAACH,SAAS,CAAC;MAE5B,OAAOE,YAAY;IACvB,CAAC;EACL,CAAC;EACDE,WAAW,EAAEA,CAAC;IAAEP;EAAI,CAAE,KAAI;IACtB,OAAO,OAAOQ,QAAQ,EAAEC,UAAU,KAAI;MAClC,MAAMN,SAAS,GAAGR,eAAe,CAACC,UAAU,CAAC;MAC7C,MAAMK,IAAI,GAAG,MAAMD,IAAI,CAAC,aAAa,EAAE;QAAEG,SAAS;QAAEK,QAAQ;QAAEC;MAAU,CAAE,CAAC;MAE3E,OAAO;QAAEN,SAAS;QAAEF;MAAI,CAAE;IAC9B,CAAC;EACL,CAAC;EACDS,QAAQ,EAAEA,CAAC;IAAEV;EAAI,CAAE,KAAI;IACnB,OAAQC,IAAI,IAAI;MACZ,OAAOD,IAAI,CAAC,UAAU,EAAE;QAAEC;MAAI,CAAE,EAAE,CAACA,IAAI,CAAC,CAAC;IAC7C,CAAC;EACL;CACH,CAAC;AAEF,OAAO,MAAMU,IAAI,GAAmCC,GAAW,IAAI;EAC/D,MAAMC,MAAM,GAAG,IAAIC,MAAM,CAACF,GAAG,CAAC;EAE9B,OAAOd,IAAI,CAACe,MAAM,CAAC;AACvB,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}